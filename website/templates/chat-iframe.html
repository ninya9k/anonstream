<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="conent-security-policy" content="default-src 'none'">
    {% if not debug %}<meta http-equiv="refresh" content="8">{% endif %}
    <style>
      body {
        margin: 0 0.5em;
        min-height: calc(100vh - 1em);
      }
      #messages {
        transform: scaleX(-1);
      }
      form {
        margin: 0;
      }
      .inline-block {
        display: inline-block;
      }
      .rotate {
        transform: rotate(-180deg);
      }
      .reverse {
        direction: rtl;
      }
      .comment {
        color: #f0f0f0;
        padding: 3px;
        overflow: hidden;
      }
      .comment:hover{
        background-color: #333;
        border-radius: 4px;
      }
      .censored {
        font-weight: normal;
        font-variant: all-small-caps;
        font-family: monospace, monospace;
        background: black;
        color: transparent;
        padding: 1px;
        cursor: default;
      }
      .censored:hover {
        color: revert;
      }
      .date {
        color: gray;
        font-size: 75%;
        text-align: center;
        cursor: default;
      }
      .date > i {
        padding: 0.25em 0 0.5em 0;
        display: block;
        border-bottom: 1px solid #333;
      }
      .name {
        color: var(--name-color);
        font-weight: bold;
        unicode-bidi: isolate;
      }
      .name:hover{
        background-color: var(--name-bg-color);
        text-shadow: 0 0 1px #{{ background_colour.hex() }};
        border-radius: 2px;
        padding: 2px;
        margin: -2px;
        cursor: default;
      }
      sup {
        margin-right: 0.125em;
        font-size: 90%;
        font-family: monospace;
      }
      .tripcode {
        font-weight: normal;
        margin-left: 0.5em;
        padding: 0 5px;
        border-radius: 6px;
        font-size: 90%;
        font-family: monospace;
        vertical-align: middle;
        display: inline-block;
        cursor: default;
      }
      .barrier {
        display: inline-block;
        margin-right: 0.5em;
      }
      .message {
        overflow-wrap: break-word;
        unicode-bidi: isolate;
      }
      .camera {
        font-style: normal;
        transform: scaleX(-1);
        text-shadow: 0px 0px 6px #{{ broadcaster_colour.hex() }};
        cursor: help;
        margin-right: 0.25em;
        word-break: keep-all;
      }
      .time {
        font-size: 80%;
        color: gray;
        vertical-align: middle;
        cursor: default;
      }
      {% if include_user_list %}
      #users {
        color: #f0f0f0;
      }
      .group {
        margin-bottom: 1.5em;
      }
      .group-name {
        margin-bottom: 0.25em;
      }
      .person {
        margin: 0 0 2px 0.5em;
      }
      .you {
        font-style: normal;
        margin-left: 0.5em;
        color: #f0f0f0;
      }
      {% endif %}

      input[type="submit"] {
        padding: 0 0.25em;
        margin-bottom: 0.5em;
      }
      .refresh {
        color: #f0f0f0;
        background-color: gray;
        position: sticky;
      /*top: 100vh;*/ /* (when upside down etc.) placement is correct with top when there is no scrollbar */
        bottom: 0;    /* (when upside down etc.) placement is correct with bottom when there is a scrollbar */
        padding: 1em;
        text-align: center;
        font-weight: bold;
        border-radius: 4px;
        box-shadow: 0px 2px 4px black;
        margin: 0;
      }
      .refresh::after {
        content: "Manual refresh required";
      }
      input[type="checkbox"] {
        vertical-align: middle;
      }
      .unhide {
        animation: unhide 0s forwards 30s;
        height: 0;
        padding: 0;
        visibility: hidden;
      }
      .unhide-margin {
        animation: unhide-margin 0s forwards 30s;
        height: 0;
        padding: 0;
        visibility: hidden;
      }
      @keyframes unhide {
        to {
          height: revert;
          padding: 1em;
          visibility: visible;
        }
      }
      @keyframes unhide-margin {
        to {
          height: revert;
          padding: 1em;
          visibility: visible;
          margin-bottom: 1.25em;
        }
      }
      td {
        width: 100vw;
      }
      /* for text-based browsers */
      .textonly {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="textonly">
      <br>
      <div><b>{{ stream_title }}</b></div>
      <div>{{ stream_viewers }} viewer(s), {% if stream_uptime %}{{ stream_uptime }} uptime{% else %}offline{% endif %}</div>
      <br>
      <div>== Chat ==</div>
    </div>
    <div id="messages">
      {% if broadcaster %}
      <form action="{{ url_for('mod_chat') }}" method="post">
        <div class="reverse">
          <input class="rotate" type="submit" name="ban" value="Ban">
          <input class="rotate" type="submit" name="hide" value="Hide">
          <input class="rotate" type="submit" name="ban_purge" value="Ban and hide all">
        </div>
      {% endif %}
        <!-- TODO: mobile tooltip / title -->
        <table border="1" frame="void" rules="rows" style="border-collapse:separate;border-spacing:0 2px;">
          <tbody>
            {% for message in messages %}
            <tr>
              {% if message.get('special') == 'date' %}
              <td class="date rotate">
                <i style="font-style:normal;">{{ message['content'] }}
                </i>
              </td>
              {% else %}
              <td class="comment rotate">
                {% include 'comment.html' %}
              </td>
              {% endif %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% if broadcaster %}
      </form>
      {% endif %}
      <a href="" style="text-decoration:none;">
        <div class="refresh unhide rotate"></div>
      </a>
    </div>
    {% if include_user_list %}
    <div class="textonly">== List of users ==</div>
    <div id="users" style="overflow:hidden;height:0;">
      <a href="" style="text-decoration:none;">
        <div class="refresh unhide-margin" style="bottom:revert;top:0;"></div>
      </a>
      <div style="margin: 0.5em 1em;">
        {% include 'users.html' %}
      </div>
    </div>
    {% endif %}
  </body>
</html>
